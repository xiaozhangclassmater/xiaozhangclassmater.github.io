(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{322:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"express是什么-🖥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#express是什么-🖥"}},[t._v("#")]),t._v(" express是什么？🖥")]),t._v(" "),s("p",[s("code",[t._v("express")]),t._v(" 是基于 "),s("a",{attrs:{href:"https://nodejs.org/en/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js"),s("OutboundLink")],1),t._v(" 平台，快速、开放、极简的 Web 开发框架。")]),t._v(" "),s("p",[t._v("他能干什么？")]),t._v(" "),s("ol",[s("li",[t._v("帮助我们更高效的开发nodejs")]),t._v(" "),s("li",[t._v("拥有灵活的中间件")]),t._v(" "),s("li",[t._v("分成结构清晰 ，易上手")])]),t._v(" "),s("h2",{attrs:{id:"nodemon的基本使用🛒"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nodemon的基本使用🛒"}},[t._v("#")]),t._v(" nodemon的基本使用🛒")]),t._v(" "),s("p",[t._v("作用 ： "),s("code",[t._v("nodemon")]),t._v("可以只需要启动一次服务，nodemo可以监听文件变化，当文件发生变化时会重新编译服务")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/remy/nodemon",target:"_blank",rel:"noopener noreferrer"}},[t._v("nodemon-github文档"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("**配置 **"),s("code",[t._v("nodemon.json")])]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"watch"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听哪些文件的变化 ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*.json"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ignore"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"package*.json"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 忽略那些文件")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nodemon.json"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"express-的基本使用✌"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#express-的基本使用✌"}},[t._v("#")]),t._v(" express 的基本使用✌")]),t._v(" "),s("h3",{attrs:{id:"_1-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装"}},[t._v("#")]),t._v(" 1 ： "),s("strong",[t._v("安装")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" express "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--save")]),t._v("\t\n")])])]),s("h3",{attrs:{id:"_2-启动一个简单服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动一个简单服务器"}},[t._v("#")]),t._v(" 2 : "),s("strong",[t._v("启动一个简单服务器")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" express "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" port "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("server running in ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("port"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3-开发接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-开发接口"}},[t._v("#")]),t._v(" 3："),s("strong",[t._v("开发接口")])]),t._v(" "),s("p",[t._v("通过 "),s("code",[t._v("get")]),t._v(" or "),s("code",[t._v("post")]),t._v("...等方法进行处理接口请求")]),t._v(" "),s("p",[s("strong",[t._v("req")]),t._v(" :请求信息 包含了 url 和 请求方法 等等")]),t._v(" "),s("p",[s("strong",[t._v("res")]),t._v(" : 响应对象，包含了响应的方法 "),s("code",[t._v("send")]),t._v(" or "),s("code",[t._v("setHeader")]),t._v(" 等等。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api/student'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res ， next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("，")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 多个callback，你也可以在里面接入中间件")]),t._v("\n")])])]),s("h2",{attrs:{id:"router🎫"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#router🎫"}},[t._v("#")]),t._v(" Router🎫")]),t._v(" "),s("p",[t._v("作用 ： "),s("strong",[t._v("express")]),t._v("的router是接近于 "),s("code",[t._v("restful")]),t._v("api接口规范,它能够帮助你统一根据某个url地址进行匹配。")]),t._v(" "),s("p",[t._v("例如")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" express "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" studentRouter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" express"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Router")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nstudentRouter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" getStudent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nstudentRouter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/:id'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" getStudentById"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nstudentRouter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addStudent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nstudentRouter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/:id'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" deleteStudent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" getStudent （req "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res）"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理函数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/bff/student'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" studentRouter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("server running in ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("port"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"中间件🎃"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#中间件🎃"}},[t._v("#")]),t._v(" 中间件🎃")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.expressjs.com.cn/guide/using-middleware.html#middleware.application",target:"_blank",rel:"noopener noreferrer"}},[t._v("更多中间件，见文档"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"常用中间件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用中间件"}},[t._v("#")]),t._v(" 常用中间件")]),t._v(" "),s("p",[t._v("1 ："),s("code",[t._v("express")]),t._v('.static("静态资源路径")')]),t._v(" "),s("p",[t._v("针对服务端的静态资源做处理的中间件，它可以将指定的服务器资源进行返回到浏览器")]),t._v(" "),s("p",[t._v("2："),s("code",[t._v("express")]),t._v(".json")]),t._v(" "),s("p",[t._v("针对请求体，数据为 JSON 类型的数据进行解析，因为网络传输的数据都是以"),s("code",[t._v("stream")]),t._v("流的形式传输，所以需要json中间件进行统一转换，最后返回对象。")]),t._v(" "),s("p",[t._v("3："),s("code",[t._v("express")]),t._v(".urlencoded")]),t._v(" "),s("p",[t._v("针对"),s("code",[t._v("application/x-www-form-urlencoded")]),t._v(" 请求的数据进行解析处理，将数据转换完成后存放到req.body中，原理同"),s("code",[t._v("express")]),t._v(".json")]),t._v(" "),s("h3",{attrs:{id:"实现-urlencoded-中间件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现-urlencoded-中间件"}},[t._v("#")]),t._v(" 实现 "),s("code",[t._v("urlencoded")]),t._v(" 中间件")]),t._v(" "),s("div",{staticClass:"language-JS extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" qs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'querystring'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content-type'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/x-www-form-urlencoded'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("chunk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" chunk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf-8'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"end"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// console.log()")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" query "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" qs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("str"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" query\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"实现客户端访问一个地址-自动下载文件到本地"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现客户端访问一个地址-自动下载文件到本地"}},[t._v("#")]),t._v(" 实现客户端访问一个地址，自动下载文件到本地？")]),t._v(" "),s("p",[t._v("实现改功能的核心在于 ，服务端将 请求的响应头设置为")]),t._v(" "),s("p",[s("code",[t._v('Content-Disposition ： attachment; filename="filename.jpg"')])]),t._v(" "),s("p",[t._v("这样 浏览器识别的 响应头的时候 遇到 attachment 会自动下载该文件")]),t._v(" "),s("div",{staticClass:"language-JS extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Router "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" downloadRouter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Router")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" downloadService  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@/services'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndownloadRouter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/:filename'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handleGetFile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置 路由")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @Description: 处理客户端下载文件\n * @author xiaoZhang\n * @date 2023/9/20\n*/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleGetFile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" downloadService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("downloadFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" downloadRouter\n\n")])])]),s("p",[s("code",[t._v("Service.js")])]),t._v(" "),s("div",{staticClass:"language-JS extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @Description: 下载文件\n * @author xiaoZhang\n * @date 2023/9/20\n*/")]),t._v("\nexports"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("downloadFile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("downloadFile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" filename "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" absPath "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("../../../public/assets/")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("filename"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("download")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("absPath "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filename"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"content-disposition"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#content-disposition"}},[t._v("#")]),t._v(" Content-Disposition")]),t._v(" "),s("p",[t._v("在 HTTP 场景中，第一个参数或者是 "),s("code",[t._v("inline")]),t._v("（默认值，表示回复中的消息体会以页面的一部分或者整个页面的形式展示），或者是 "),s("code",[t._v("attachment")]),t._v("（意味着消息体应该被下载到本地；大多数浏览器会呈现一个“保存为”的对话框，将 "),s("code",[t._v("filename")]),t._v(" 的值预填为下载后的文件名，假如它存在的话）")]),t._v(" "),s("div",{staticClass:"language-JSON extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("Content-Disposition"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" inline\nContent-Disposition"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" attachment\nContent-Disposition"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" attachment; filename="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"filename.jpg"')]),t._v("\n")])])]),s("h2",{attrs:{id:"cookie的组成⚽"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie的组成⚽"}},[t._v("#")]),t._v(" cookie的组成⚽")]),t._v(" "),s("p",[t._v("cookie是浏览器中特有的一个概念，它就像浏览器的专属卡包，管理着各个网站的身份信息。")]),t._v(" "),s("p",[t._v("每个cookie就相当于是属于某个网站的一个卡片，它记录了下面的信息：")]),t._v(" "),s("ul",[s("li",[t._v("key：键，比如「身份编号」")]),t._v(" "),s("li",[t._v("value：值，比如袁小进的身份编号「14563D1550F2F76D69ECBF4DD54ABC95」，这有点像卡片的条形码，当然，它可以是任何信息")]),t._v(" "),s("li",[t._v("domain：域，表达这个cookie是属于哪个网站的，比如"),s("code",[t._v("yuanjin.tech")]),t._v("，表示这个cookie是属于"),s("code",[t._v("yuanjin.tech")]),t._v("这个网站的")]),t._v(" "),s("li",[t._v("path：路径，表达这个cookie是属于该网站的哪个基路径的，就好比是同一家公司不同部门会颁发不同的出入证。比如"),s("code",[t._v("/news")]),t._v("，表示这个cookie属于"),s("code",[t._v("/news")]),t._v("这个路径的。（后续详细解释）")]),t._v(" "),s("li",[t._v("secure：是否使用安全传输（后续详细解释）")]),t._v(" "),s("li",[t._v("expire：过期时间，表示该cookie在什么时候过期")])]),t._v(" "),s("p",[t._v("当浏览器向服务器发送一个请求的时候，它会瞄一眼自己的卡包，看看哪些卡片适合附带捎给服务器")]),t._v(" "),s("p",[t._v("如果一个cookie"),s("strong",[t._v("同时满足")]),t._v("以下条件，则这个cookie会被附带到请求中")]),t._v(" "),s("ul",[s("li",[t._v("cookie没有过期")]),t._v(" "),s("li",[t._v("cookie中的域和这次请求的域是匹配的\n"),s("ul",[s("li",[t._v("比如cookie中的域是"),s("code",[t._v("yuanjin.tech")]),t._v("，则可以匹配的请求域是"),s("code",[t._v("yuanjin.tech")]),t._v("、"),s("code",[t._v("www.yuanjin.tech")]),t._v("、"),s("code",[t._v("blogs.yuanjin.tech")]),t._v("等等")]),t._v(" "),s("li",[t._v("比如cookie中的域是"),s("code",[t._v("www.yuanjin.tech")]),t._v("，则只能匹配"),s("code",[t._v("www.yuanjin.tech")]),t._v("这样的请求域")]),t._v(" "),s("li",[t._v("cookie是不在乎端口的，只要域匹配即可")])])]),t._v(" "),s("li",[t._v("cookie中的path和这次请求的path是匹配的\n"),s("ul",[s("li",[t._v("比如cookie中的path是"),s("code",[t._v("/news")]),t._v("，则可以匹配的请求路径可以是"),s("code",[t._v("/news")]),t._v("、"),s("code",[t._v("/news/detail")]),t._v("、"),s("code",[t._v("/news/a/b/c")]),t._v("等等，但不能匹配"),s("code",[t._v("/blogs")])]),t._v(" "),s("li",[t._v("如果cookie的path是"),s("code",[t._v("/")]),t._v("，可以想象，能够匹配所有的路径")])])]),t._v(" "),s("li",[t._v("验证cookie的安全传输\n"),s("ul",[s("li",[t._v("如果cookie的secure属性是true，则请求协议必须是"),s("code",[t._v("https")]),t._v("，否则不会发送该cookie")]),t._v(" "),s("li",[t._v("如果cookie的secure属性是false，则请求协议可以是"),s("code",[t._v("http")]),t._v("，也可以是"),s("code",[t._v("https")])])])])]),t._v(" "),s("p",[t._v("如果一个cookie满足了上述的所有条件，则浏览器会把它自动加入到这次请求中")]),t._v(" "),s("p",[t._v("具体加入的方式是，"),s("strong",[t._v("浏览器会将符合条件的cookie，自动放置到请求头中")]),t._v("，例如，当我在浏览器中访问百度的时候，它在请求头中附带了下面的cookie：")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200417170328584.png",alt:""}})]),t._v(" "),s("p",[t._v("看到打马赛克的地方了吗？这部分就是通过请求头"),s("code",[t._v("cookie")]),t._v("发送到服务器的，它的格式是"),s("code",[t._v("键=值; 键=值; 键=值; ...")]),t._v("，每一个键值对就是一个符合条件的cookie。")]),t._v(" "),s("p",[t._v("**cookie中包含了重要的身份信息，永远不要把你的cookie泄露给别人！！！**否则，他人就拿到了你的证件，有了证件，就具备了为所欲为的可能性。")]),t._v(" "),s("h2",{attrs:{id:"设置cookie🤷‍♂️"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置cookie🤷‍♂️"}},[t._v("#")]),t._v(" 设置cookie🤷‍♂️")]),t._v(" "),s("p",[t._v("由于cookie是保存在浏览器端的，同时，很多证件又是服务器颁发的")]),t._v(" "),s("p",[t._v("所以，cookie的设置有两种模式：")]),t._v(" "),s("ul",[s("li",[t._v("服务器响应：这种模式是非常普遍的，当服务器决定给客户端颁发一个证件时，它会在响应的消息中包含cookie，浏览器会自动的把cookie保存到卡包中")]),t._v(" "),s("li",[t._v("客户端自行设置：这种模式少见一些，不过也有可能会发生，比如用户关闭了某个广告，并选择了「以后不要再弹出」，此时就可以把这种小信息直接通过浏览器的JS代码保存到cookie中。后续请求服务器时，服务器会看到客户端不想要再次弹出广告的cookie，于是就不会再发送广告过来了。")])]),t._v(" "),s("h2",{attrs:{id:"服务器端设置cookie🤦‍♂️"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务器端设置cookie🤦‍♂️"}},[t._v("#")]),t._v(" 服务器端设置cookie🤦‍♂️")]),t._v(" "),s("p",[t._v("服务器可以通过设置响应头，来告诉浏览器应该如何设置cookie")]),t._v(" "),s("p",[t._v("响应头按照下面的格式设置：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("set-cookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cookie1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("set-cookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cookie2\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("set-cookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cookie3\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n")])])]),s("p",[t._v("通过这种模式，就可以在一次响应中设置多个cookie了，具体设置多少个cookie，设置什么cookie，根据你的需要自行处理")]),t._v(" "),s("p",[t._v("其中，每个cookie的格式如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("键=值; path=?; domain=?; expire=?; max-age=?; secure; httponly\n")])])]),s("p",[t._v("每个cookie除了键值对是必须要设置的，其他的属性都是可选的，并且顺序不限")]),t._v(" "),s("p",[t._v("当这样的响应头到达客户端后，"),s("strong",[t._v("浏览器会自动的将cookie保存到卡包中，如果卡包中已经存在一模一样的卡片（其他key、path、domain相同），则会自动的覆盖之前的设置")]),t._v("。")]),t._v(" "),s("p",[t._v("下面，依次说明每个属性值：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("path")]),t._v("：设置cookie的路径。如果不设置，浏览器会将其自动设置为当前请求的路径。比如，浏览器请求的地址是"),s("code",[t._v("/login")]),t._v("，服务器响应了一个"),s("code",[t._v("set-cookie: a=1")]),t._v("，浏览器会将该cookie的path设置为请求的路径"),s("code",[t._v("/login")])]),t._v(" "),s("li",[s("strong",[t._v("domain")]),t._v("：设置cookie的域。如果不设置，浏览器会自动将其设置为当前的请求域，比如，浏览器请求的地址是"),s("code",[t._v("http://www.yuanjin.tech")]),t._v("，服务器响应了一个"),s("code",[t._v("set-cookie: a=1")]),t._v("，浏览器会将该cookie的domain设置为请求的域"),s("code",[t._v("www.yuanjin.tech")]),t._v(" "),s("ul",[s("li",[t._v("这里值得注意的是，如果服务器响应了一个无效的域，浏览器是不认的")]),t._v(" "),s("li",[t._v("什么是无效的域？就是响应的域连根域都不一样。比如，浏览器请求的域是"),s("code",[t._v("yuanjin.tech")]),t._v("，服务器响应的cookie是"),s("code",[t._v("set-cookie: a=1; domain=baidu.com")]),t._v("，这样的域浏览器是不认的。")]),t._v(" "),s("li",[t._v("如果浏览器连这样的情况都允许，就意味着张三的服务器，有权利给用户一个cookie，用于访问李四的服务器，这会造成很多安全性的问题")])])]),t._v(" "),s("li",[s("strong",[t._v("expire")]),t._v("：设置cookie的过期时间。这里必须是一个有效的GMT时间，即格林威治标准时间字符串，比如"),s("code",[t._v("Fri, 17 Apr 2020 09:35:59 GMT")]),t._v("，表示格林威治时间的"),s("code",[t._v("2020-04-17 09:35:59")]),t._v("，即北京时间的"),s("code",[t._v("2020-04-17 17:35:59")]),t._v("。当客户端的时间达到这个时间点后，会自动销毁该cookie。")]),t._v(" "),s("li",[s("strong",[t._v("max-age")]),t._v("：设置cookie的相对有效期。expire和max-age通常仅设置一个即可。比如设置"),s("code",[t._v("max-age")]),t._v("为"),s("code",[t._v("1000")]),t._v("，浏览器在添加cookie时，会自动设置它的"),s("code",[t._v("expire")]),t._v("为当前时间加上1000秒，作为过期时间。\n"),s("ul",[s("li",[t._v("如果不设置expire，又没有设置max-age，则表示会话结束后过期。")]),t._v(" "),s("li",[t._v("对于大部分浏览器而言，关闭所有浏览器窗口意味着会话结束。")])])]),t._v(" "),s("li",[s("strong",[t._v("secure")]),t._v("：设置cookie是否是安全连接。如果设置了该值，则表示该cookie后续只能随着"),s("code",[t._v("https")]),t._v("请求发送。如果不设置，则表示该cookie会随着所有请求发送。")]),t._v(" "),s("li",[s("strong",[t._v("httponly")]),t._v("：设置cookie是否仅能用于传输。如果设置了该值，表示该cookie仅能用于传输，而不允许在客户端通过JS获取，这对防止跨站脚本攻击（XSS）会很有用。\n"),s("ul",[s("li",[t._v("关于如何通过JS获取，后续会讲解")]),t._v(" "),s("li",[t._v("关于什么是XSS，不在本文讨论范围")])])])]),t._v(" "),s("p",[t._v("下面来一个例子，客户端通过"),s("code",[t._v("post")]),t._v("请求服务器"),s("code",[t._v("http://yuanjin.tech/login")]),t._v("，并在消息体中给予了账号和密码，服务器验证登录成功后，在响应头中加入了以下内容：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("set-cookie: token=123456; path=/; max-age=3600; httponly\n")])])]),s("p",[t._v("当该响应到达浏览器后，浏览器会创建下面的cookie：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" token\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("domain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yuanjin.tech\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("expire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token datetime number"}},[t._v("2020-04-17 18:55:00")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#假设当前时间是2020-04-17 17:55:00")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secure")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#任何请求都可以附带这个cookie，只要满足其他要求")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("httponly")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不允许JS获取该cookie")]),t._v("\n")])])]),s("p",[t._v("于是，随着浏览器后续对服务器的请求，只要满足要求，这个cookie就会被附带到请求头中传给服务器：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" token=123456; 其他cookie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n")])])]),s("p",[t._v("现在，还剩下最后一个问题，就是如何删除浏览器的一个cookie呢？")]),t._v(" "),s("p",[t._v("如果要删除浏览器的cookie，只需要让服务器响应一个同样的域、同样的路径、同样的key，只是时间过期的cookie即可")]),t._v(" "),s("p",[s("strong",[t._v("所以，删除cookie其实就是修改cookie")])]),t._v(" "),s("p",[t._v("下面的响应会让浏览器删除"),s("code",[t._v("token")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" token=; domain=yuanjin.tech; path=/; max"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("age="),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),s("p",[t._v("浏览器按照要求修改了cookie后，会发现cookie已经过期，于是自然就会删除了。")]),t._v(" "),s("blockquote",[s("p",[t._v("无论是修改还是删除，都要注意cookie的域和路径，因为完全可能存在域或路径不同，但key相同的cookie")]),t._v(" "),s("p",[t._v("因此无法仅通过key确定是哪一个cookie")])]),t._v(" "),s("h2",{attrs:{id:"客户端设置cookie🐱‍👓"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端设置cookie🐱‍👓"}},[t._v("#")]),t._v(" 客户端设置cookie🐱‍👓")]),t._v(" "),s("p",[t._v("既然cookie是存放在浏览器端的，所以浏览器向JS公开了接口，让其可以设置cookie")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"键=值; path=?; domain=?; expire=?; max-age=?; secure"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("可以看出，在客户端设置cookie，和服务器设置cookie的格式一样，只是有下面的不同")]),t._v(" "),s("ul",[s("li",[t._v("没有httponly。因为httponly本来就是为了限制在客户端访问的，既然你是在客户端配置，自然失去了限制的意义。")]),t._v(" "),s("li",[t._v("path的默认值。在服务器端设置cookie时，如果没有写path，使用的是请求的path。而在客户端设置cookie时，也许根本没有请求发生。因此，path在客户端设置时的默认值是当前网页的path")]),t._v(" "),s("li",[t._v("domain的默认值。和path同理，客户端设置时的默认值是当前网页的domain")]),t._v(" "),s("li",[t._v("其他：一样")]),t._v(" "),s("li",[t._v("删除cookie：和服务器也一样，修改cookie的过期时间即可")])]),t._v(" "),s("h2",{attrs:{id:"cookie-总结🎂"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie-总结🎂"}},[t._v("#")]),t._v(" cookie 总结🎂")]),t._v(" "),s("p",[t._v("以上，就是cookie原理部分的内容。")]),t._v(" "),s("p",[t._v("如果把它用于登录场景，就是如下的流程：")]),t._v(" "),s("p",[s("strong",[t._v("登录请求")])]),t._v(" "),s("ol",[s("li",[t._v("浏览器发送请求到服务器，附带账号密码")]),t._v(" "),s("li",[t._v("服务器验证账号密码是否正确，如果不正确，响应错误，如果正确，在响应头中设置cookie，附带登录认证信息（至于登录认证信息是设么样的，如何设计，要考虑哪些问题，就是另一个话题了，可以百度 jwt）")]),t._v(" "),s("li",[t._v("客户端收到cookie，浏览器自动记录下来")])]),t._v(" "),s("p",[s("strong",[t._v("后续请求")])]),t._v(" "),s("ol",[s("li",[t._v("浏览器发送请求到服务器，希望添加一个管理员，并将cookie自动附带到请求中")]),t._v(" "),s("li",[t._v("服务器先获取cookie，验证cookie中的信息是否正确，如果不正确，不予以操作，如果正确，完成正常的业务流程")])])])}),[],!1,null,null,null);s.default=e.exports}}]);