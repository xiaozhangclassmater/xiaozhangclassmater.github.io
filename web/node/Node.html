<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nodeè¯¾ç¨‹ç¬”è®°</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.a90809c0.css" as="style"><link rel="preload" href="/assets/js/app.feb21b2a.js" as="script"><link rel="preload" href="/assets/js/2.75ba61f2.js" as="script"><link rel="preload" href="/assets/js/5.fb1d9eba.js" as="script"><link rel="prefetch" href="/assets/js/10.be2d4676.js"><link rel="prefetch" href="/assets/js/11.a6cdee63.js"><link rel="prefetch" href="/assets/js/12.f66c58d3.js"><link rel="prefetch" href="/assets/js/13.f6a7ab74.js"><link rel="prefetch" href="/assets/js/14.f2495746.js"><link rel="prefetch" href="/assets/js/15.501e6ef6.js"><link rel="prefetch" href="/assets/js/16.f88cdb61.js"><link rel="prefetch" href="/assets/js/17.cee20973.js"><link rel="prefetch" href="/assets/js/18.45990e00.js"><link rel="prefetch" href="/assets/js/19.c5e4d633.js"><link rel="prefetch" href="/assets/js/20.72e018c7.js"><link rel="prefetch" href="/assets/js/21.bc6f4b58.js"><link rel="prefetch" href="/assets/js/22.233bac0d.js"><link rel="prefetch" href="/assets/js/3.ec1e420f.js"><link rel="prefetch" href="/assets/js/4.0a0d7342.js"><link rel="prefetch" href="/assets/js/6.695dc6e3.js"><link rel="prefetch" href="/assets/js/7.f7cf561e.js"><link rel="prefetch" href="/assets/js/8.65918f4e.js"><link rel="prefetch" href="/assets/js/9.74b6acd4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a90809c0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://xiaozhangclassmater.github.io/minivueBarrage-docs-web/#/dashboard" target="_self" class="nav-link external">
  é¦–é¡µ
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webçŸ¥è¯†å¹¿åœº" class="dropdown-title"><span class="title">webçŸ¥è¯†å¹¿åœº</span> <span class="arrow down"></span></button> <button type="button" aria-label="webçŸ¥è¯†å¹¿åœº" class="mobile-dropdown-title"><span class="title">webçŸ¥è¯†å¹¿åœº</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/javascript/javascript.html" class="nav-link">
  JavaScriptç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/web/vue/vue3.html" class="nav-link">
  vueç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/web/React/React.html" class="nav-link">
  reactç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/web/webpack/webpack.html" class="nav-link">
  webpackç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/web/Browser/Browser.html" class="nav-link">
  æµè§ˆå™¨ç¬”è®°
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NodeJsç³»åˆ—" class="dropdown-title"><span class="title">NodeJsç³»åˆ—</span> <span class="arrow down"></span></button> <button type="button" aria-label="NodeJsç³»åˆ—" class="mobile-dropdown-title"><span class="title">NodeJsç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/node/Node.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  NodeJSç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/web/ORM/ORM.html" class="nav-link">
  Node_ORMæ¡†æ¶ç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/web/express/express.html" class="nav-link">
  expressç¬”è®°
</a></li></ul></div></div><div class="nav-item"><a href="/web/sql/mysql.html" class="nav-link">
  sqlç¬”è®°
</a></div><div class="nav-item"><a href="/web/netWork/netWork.html" class="nav-link">
  è®¡ç®—æœºç½‘ç»œç¬”è®°
</a></div><div class="nav-item"><a href="/web/InterviewQuestion/InterviewQuestion.html" class="nav-link">
  é¢è¯•é¢˜
</a></div><div class="nav-item"><a href="/web/studyNote/studyNote.html" class="nav-link">
  å·¥ä½œç¬”è®°
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://xiaozhangclassmater.github.io/minivueBarrage-docs-web/#/dashboard" target="_self" class="nav-link external">
  é¦–é¡µ
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webçŸ¥è¯†å¹¿åœº" class="dropdown-title"><span class="title">webçŸ¥è¯†å¹¿åœº</span> <span class="arrow down"></span></button> <button type="button" aria-label="webçŸ¥è¯†å¹¿åœº" class="mobile-dropdown-title"><span class="title">webçŸ¥è¯†å¹¿åœº</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/javascript/javascript.html" class="nav-link">
  JavaScriptç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/web/vue/vue3.html" class="nav-link">
  vueç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/web/React/React.html" class="nav-link">
  reactç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/web/webpack/webpack.html" class="nav-link">
  webpackç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/web/Browser/Browser.html" class="nav-link">
  æµè§ˆå™¨ç¬”è®°
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NodeJsç³»åˆ—" class="dropdown-title"><span class="title">NodeJsç³»åˆ—</span> <span class="arrow down"></span></button> <button type="button" aria-label="NodeJsç³»åˆ—" class="mobile-dropdown-title"><span class="title">NodeJsç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/node/Node.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  NodeJSç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/web/ORM/ORM.html" class="nav-link">
  Node_ORMæ¡†æ¶ç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/web/express/express.html" class="nav-link">
  expressç¬”è®°
</a></li></ul></div></div><div class="nav-item"><a href="/web/sql/mysql.html" class="nav-link">
  sqlç¬”è®°
</a></div><div class="nav-item"><a href="/web/netWork/netWork.html" class="nav-link">
  è®¡ç®—æœºç½‘ç»œç¬”è®°
</a></div><div class="nav-item"><a href="/web/InterviewQuestion/InterviewQuestion.html" class="nav-link">
  é¢è¯•é¢˜
</a></div><div class="nav-item"><a href="/web/studyNote/studyNote.html" class="nav-link">
  å·¥ä½œç¬”è®°
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/" class="sidebar-heading clickable router-link-active"><span>å¿«é€Ÿä¸Šæ‰‹</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ä¸ªäººç¬”è®°</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/javascript/javascript.html" class="sidebar-link">JavaScript</a></li><li><a href="/web/webpack/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/web/vue/vue3.html" class="sidebar-link">vue3</a></li><li><a href="/web/React/React.html" class="sidebar-link">React</a></li><li><a href="/web/node/Node.html" aria-current="page" class="active sidebar-link">NodeJS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/node/Node.html#nodeä¸­å…¨å±€å¯¹è±¡ğŸ’" class="sidebar-link">nodeä¸­å…¨å±€å¯¹è±¡ğŸ’</a></li><li class="sidebar-sub-header"><a href="/web/node/Node.html#asciiç è¡¨ğŸ¨" class="sidebar-link">ASCIIç è¡¨ğŸ¨</a></li><li class="sidebar-sub-header"><a href="/web/node/Node.html#bufferå¯¹è±¡-âš½" class="sidebar-link">bufferå¯¹è±¡ âš½</a></li><li class="sidebar-sub-header"><a href="/web/node/Node.html#nodeä¸­-esæ¨¡å—ğŸƒ" class="sidebar-link">nodeä¸­ ESæ¨¡å—ğŸƒ</a></li><li class="sidebar-sub-header"><a href="/web/node/Node.html#fsæ¨¡å—ğŸ’»" class="sidebar-link">fsæ¨¡å—ğŸ’»</a></li><li class="sidebar-sub-header"><a href="/web/node/Node.html#stream-æµğŸˆ" class="sidebar-link">stream æµğŸˆ</a></li><li class="sidebar-sub-header"><a href="/web/node/Node.html#os-æ¨¡å—ğŸ–¥" class="sidebar-link">OS æ¨¡å—ğŸ–¥</a></li><li class="sidebar-sub-header"><a href="/web/node/Node.html#path-æ¨¡å—ğŸ”—" class="sidebar-link">path æ¨¡å—ğŸ”—</a></li><li class="sidebar-sub-header"><a href="/web/node/Node.html#utilså·¥å…·æ¨¡å—âœ‚" class="sidebar-link">utilså·¥å…·æ¨¡å—âœ‚</a></li><li class="sidebar-sub-header"><a href="/web/node/Node.html#netæ¨¡å—âš”" class="sidebar-link">netæ¨¡å—âš”</a></li><li class="sidebar-sub-header"><a href="/web/node/Node.html#httpå’Œ-https-æ¨¡å—ğŸ—‘" class="sidebar-link">HTTPå’Œ HTTPS æ¨¡å—ğŸ—‘</a></li><li class="sidebar-sub-header"><a href="/web/node/Node.html#nodejs-eventemmiter" class="sidebar-link">nodejs - EventEmmiter</a></li><li class="sidebar-sub-header"><a href="/web/node/Node.html#nodejs-äº‹ä»¶å¾ªç¯ğŸš™" class="sidebar-link">nodejs äº‹ä»¶å¾ªç¯ğŸš™</a></li></ul></li><li><a href="/web/sql/mysql.html" class="sidebar-link">Mysql</a></li><li><a href="/web/ORM/ORM.html" class="sidebar-link">Node_ORM</a></li><li><a href="/web/express/express.html" class="sidebar-link">express</a></li><li><a href="/web/Browser/Browser.html" class="sidebar-link">Browser</a></li><li><a href="/web/InterviewQuestion/InterviewQuestion.html" class="sidebar-link">é¢è¯•é¢˜</a></li><li><a href="/web/netWork/netWork.html" class="sidebar-link">è®¡ç®—æœºç½‘ç»œ</a></li><li><a href="/web/studyNote/studyNote.html" class="sidebar-link">å·¥ä½œç¬”è®°</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nodeè¯¾ç¨‹ç¬”è®°"><a href="#nodeè¯¾ç¨‹ç¬”è®°" class="header-anchor">#</a> nodeè¯¾ç¨‹ç¬”è®°</h1> <h2 id="nodeä¸­å…¨å±€å¯¹è±¡ğŸ’"><a href="#nodeä¸­å…¨å±€å¯¹è±¡ğŸ’" class="header-anchor">#</a> nodeä¸­å…¨å±€å¯¹è±¡ğŸ’</h2> <h3 id="global"><a href="#global" class="header-anchor">#</a> global</h3> <p>nodejsä¸­çš„å…¨å±€å¯¹è±¡</p> <h3 id="settimeout-setimmediate-setinterval"><a href="#settimeout-setimmediate-setinterval" class="header-anchor">#</a> setTimeOut ï¼Œ setimmediate ï¼ŒsetInterval</h3> <h2 id="asciiç è¡¨ğŸ¨"><a href="#asciiç è¡¨ğŸ¨" class="header-anchor">#</a> ASCIIç è¡¨ğŸ¨</h2> <p><img src="/assets/img/1691808335995.0f2286cc.png" alt="1691808335995"></p> <p><img src="/assets/img/1691808373006.f730c529.png" alt="1691808373006"></p> <h2 id="bufferå¯¹è±¡-âš½"><a href="#bufferå¯¹è±¡-âš½" class="header-anchor">#</a> bufferå¯¹è±¡ âš½</h2> <h3 id="å­—ç¬¦ä¸²å¤§å°"><a href="#å­—ç¬¦ä¸²å¤§å°" class="header-anchor">#</a> å­—ç¬¦ä¸²å¤§å°</h3> <p>ä¸­æ–‡æ¯ä¸€ä¸ªutf-8 çš„å ç”¨ <code>3</code>ä¸ªå­—èŠ‚</p> <h3 id="alloc"><a href="#alloc" class="header-anchor">#</a> alloc</h3> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">let</span> buf_1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment">// åˆ›å»ºçš„ ç©ºé—´ ä½¿ç”¨åå°±è¢«é”€æ¯</span>
</code></pre></div><h3 id="allocunsafe"><a href="#allocunsafe" class="header-anchor">#</a> allocUnsafe</h3> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">let</span> buf_2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">allocUnsafe</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// åˆ›å»ºçš„ç©ºé—´æ— æ³•è¢«é”€æ¯</span>
</code></pre></div><h3 id="ä½¿ç”¨åè¿›åˆ¶æ•°æ®è½¬æ¢å­—ç¬¦"><a href="#ä½¿ç”¨åè¿›åˆ¶æ•°æ®è½¬æ¢å­—ç¬¦" class="header-anchor">#</a> ä½¿ç”¨åè¿›åˆ¶æ•°æ®è½¬æ¢å­—ç¬¦</h3> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token comment">// buffer ä¸€äº›åŸºæœ¬æ“ä½œ</span>
<span class="token keyword">let</span> buf_4 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…«ä¸ª åè¿›åˆ¶çš„ascll</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf_4<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// for (let i = 0; i &lt; buf_4.length; i++) {</span>
<span class="token comment">//   console.log('ä½ çŸ¥é“è¿™æ˜¯ä»€ä¹ˆå—?', buf_4[i].toString(2));</span>
<span class="token comment">// }</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf_4<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// buffer è½¬ å­—ç¬¦ä¸²</span>


<span class="token keyword">let</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Assets'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 

</code></pre></div><h2 id="nodeä¸­-esæ¨¡å—ğŸƒ"><a href="#nodeä¸­-esæ¨¡å—ğŸƒ" class="header-anchor">#</a> nodeä¸­ ESæ¨¡å—ğŸƒ</h2> <h3 id="nodeä¸­-å®šä¹‰-es-æ¨¡å—-çš„æ–¹å¼"><a href="#nodeä¸­-å®šä¹‰-es-æ¨¡å—-çš„æ–¹å¼" class="header-anchor">#</a> nodeä¸­ å®šä¹‰ es æ¨¡å— çš„æ–¹å¼</h3> <ol><li>mjs(å®šä¹‰æ–‡ä»¶åä»¥ .mjs ç»“å°¾)</li> <li>è®¾ç½® package.json  type = module</li></ol> <h4 id="å®ƒä»¬ä¸commonjsçš„åŒºåˆ«"><a href="#å®ƒä»¬ä¸commonjsçš„åŒºåˆ«" class="header-anchor">#</a> <strong>å®ƒä»¬ä¸commonJsçš„åŒºåˆ« ï¼Ÿ</strong></h4> <p><code>commonjs</code> è¿è¡Œåœ¨å‡½æ•°ç¯å¢ƒä¸­</p> <p><code>esModule</code> : è¿è¡Œåœ¨æ¨¡å—ä¸­ï¼Œæ—  <code>export</code> or <code>module.export</code></p> <p><code>esModule.mjs</code></p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">3</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token string">'index'</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>index.mjs</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> esModule <span class="token keyword">from</span> <span class="token string">'./esModule.mjs'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'esModule'</span><span class="token punctuation">,</span> esModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="fsæ¨¡å—ğŸ’»"><a href="#fsæ¨¡å—ğŸ’»" class="header-anchor">#</a> fsæ¨¡å—ğŸ’»</h2> <h3 id="fsreadfile-æ–¹æ³•"><a href="#fsreadfile-æ–¹æ³•" class="header-anchor">#</a> fsReadFile æ–¹æ³•</h3> <p><code>callback</code>å½¢å¼</p> <div class="language-JS extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./testWriteContent.txt'</span> <span class="token punctuation">,</span> <span class="token string">'utf-8'</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err <span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// or åŒæ­¥å½¢å¼ </span>
fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./testWriteContent.txt'</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err <span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>promises</code>å½¢å¼</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./testWriteContent.txt'</span> <span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="statæ–¹æ³•"><a href="#statæ–¹æ³•" class="header-anchor">#</a> statæ–¹æ³•</h3> <p>è·å–æ–‡ä»¶ä¿¡æ¯</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> info <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;console&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> stat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>promises<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fileStat <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">stat</span><span class="token punctuation">(</span><span class="token string">'./img/windows-copy.png'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> fileStat<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿”å›æ–‡ä»¶ä¿¡æ¯</span>
  <span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'ä¸Šæ¬¡è®¿é—®æ­¤æ–‡ä»¶çš„æ—¶é—´æˆ³'</span><span class="token punctuation">,</span> fileStat<span class="token punctuation">.</span>atime<span class="token punctuation">)</span> <span class="token comment">// æŒ‡ç¤ºä¸Šæ¬¡è®¿é—®æ­¤æ–‡ä»¶çš„æ—¶é—´æˆ³ã€‚</span>
  <span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'ä¸Šæ¬¡ä¿®æ”¹æ­¤æ–‡ä»¶çš„æ—¶é—´æˆ³'</span><span class="token punctuation">,</span> fileStat<span class="token punctuation">.</span>mtime<span class="token punctuation">)</span> <span class="token comment">// æŒ‡ç¤ºä¸Šæ¬¡ä¿®æ”¹æ­¤æ–‡ä»¶çš„æ—¶é—´æˆ³ã€‚</span>
  <span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'ä¸Šæ¬¡æ›´æ”¹æ–‡ä»¶çŠ¶æ€çš„æ—¶é—´æˆ³'</span><span class="token punctuation">,</span> fileStat<span class="token punctuation">.</span>ctime<span class="token punctuation">)</span> <span class="token comment">// æŒ‡ç¤ºä¸Šæ¬¡æ›´æ”¹æ–‡ä»¶çŠ¶æ€çš„æ—¶é—´æˆ³ã€‚</span>
  <span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'å¤§å°'</span><span class="token punctuation">,</span> fileStat<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token comment">// æŒ‡ç¤ºæ–‡ä»¶å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</span>
  <span class="token function">info</span><span class="token punctuation">(</span>fileStat<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹</span>

<span class="token punctuation">}</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="writefileæ–¹æ³•"><a href="#writefileæ–¹æ³•" class="header-anchor">#</a> writeFileæ–¹æ³•</h3> <p>desc ï¼š <strong>å¼‚æ­¥å†™å…¥å†…å®¹åˆ°æ–‡ä»¶ä¸­</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å†™å…¥å†…å®¹åˆ°æ–‡ä»¶</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token comment">/*
@description flag a ï¼šè¿½åŠ å†™å…¥
@encoding å­—ç¬¦ç¼–ç åŠ
*/</span>
<span class="token keyword">function</span> <span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">flag</span><span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">'utf-8'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å†™å…¥æˆåŠŸ -- å¼‚æ­¥&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./docs/text.txt'</span><span class="token punctuation">,</span> <span class="token string">'å­¦ä¹ nodeJS fs æ¨¡å— writeFile æ–¹æ³•'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="writefilesync-æ–¹æ³•"><a href="#writefilesync-æ–¹æ³•" class="header-anchor">#</a> writeFileSync æ–¹æ³•</h3> <p><strong>desc</strong> ï¼š åŒæ­¥å†™å…¥å†…å®¹åˆ°æ–‡ä»¶ä¸­</p> <div class="language-JS extra-class"><pre class="language-js"><code> fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="appendfileæ–¹æ³•"><a href="#appendfileæ–¹æ³•" class="header-anchor">#</a> appendFileæ–¹æ³•</h3> <p><strong>desc</strong> : è¿½åŠ å†™å…¥æ–‡ä»¶å†…å®¹</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">appendContent</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> content<span class="token punctuation">,</span> sync</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å†™å…¥æˆåŠŸ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">appendContent</span><span class="token punctuation">(</span><span class="token string">'./docs/text.txt'</span><span class="token punctuation">,</span> <span class="token string">'è¿½åŠ å†™å…¥æ–°çš„å†…å®¹ ï¼Œè¿™æ¬¡å†™å…¥ä¸º å¥½å¥½å¥½å“ˆ\d111'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="stream-æµğŸˆ"><a href="#stream-æµğŸˆ" class="header-anchor">#</a> stream æµğŸˆ</h2> <p><img src="/assets/img/1693103507353.dda0b37a.png" alt="1693103507353"></p> <h3 id="ä»€ä¹ˆæ˜¯æµ"><a href="#ä»€ä¹ˆæ˜¯æµ" class="header-anchor">#</a> ä»€ä¹ˆæ˜¯æµï¼Ÿ</h3> <p>ç”±äºæ–‡ä»¶çš„å†…å®¹ä¼ è¾“è®¡ç®—æœºè¯†åˆ«ä¸ºå­—èŠ‚ç ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æµçš„å½¢å¼è¿›è¡Œä¼ è¾“ï¼Œç›¸å½“äºæ˜¯æ–‡ä»¶æµï¼Œå°†ä¸€ä¸ªä¸ªå­—èŠ‚ä¼ è¾“å­˜å…¥ç¡¬ç›˜ä¸­ï¼Œæˆ–è€…ä»ç¡¬ç›˜ä¸­è¯»å–æ”¾å…¥å†…å­˜ä¸­çš„ä¸€ç§å½¢å¼ã€‚</p> <h3 id="createwritestream-å¯å†™æµ"><a href="#createwritestream-å¯å†™æµ" class="header-anchor">#</a> createWriteStream å¯å†™æµ</h3> <p><strong>desc</strong>ï¼š è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªä¸ç¡¬ç›˜å†™å…¥å†…å®¹é€šé“</p> <p><strong>return</strong> ï¼š ws.write() <strong>è¿”å›å€¼</strong> --- &gt; è¿”å›ä¸€ä¸ª é€šé“æ˜¯å¦è¢«å æ»¡çš„Boolean å¸ƒå°”å€¼</p> <p>â€‹	1 ï¼š å½“ ws.write è¿”å›å€¼ä¸º false æ—¶åˆ™è¯æ˜ å½“å‰å†™å…¥ç¡¬ç›˜é€šé“å·²ç»ç”¨å®Œäº†ï¼Œåä¹‹åˆ™ç©ºé—²</p> <p><strong>Event</strong></p> <p>â€‹	drainäº‹ä»¶ ï¼š å½“å†™å…¥ç®¡é“é‡æ–°å˜æˆç©ºé—²æ—¶ï¼Œè‡ªåŠ¨å›è°ƒè¯¥å‡½æ•°</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token comment">// å†™å…¥é˜Ÿåˆ— èƒŒå‹é—®é¢˜ </span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fileName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../File/streamæµå½¢å¼å†™å…¥.txt'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>fileName <span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">encoding</span> <span class="token operator">:</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">autoClose</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">highWaterMark</span> <span class="token operator">:</span> <span class="token number">16</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ–‡ä»¶å¼€å§‹å†™å…¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// writeFlag å†™å…¥é€šé“æ˜¯å¦å·²ç»æ²¾æ»¡ </span>
<span class="token keyword">function</span> <span class="token function">writeContent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> writeFlag <span class="token operator">=</span> ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">writeContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="createreadstreamå¯è¯»æµ"><a href="#createreadstreamå¯è¯»æµ" class="header-anchor">#</a> createReadStreamå¯è¯»æµ</h3> <p><strong>desc</strong>ï¼š è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªä¸ç¡¬ç›˜è¯»å–å†…å®¹é€šé“</p> <p>ä»¥æµçš„å½¢å¼è¯»å–æ–‡ä»¶å†…å®¹</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token comment">// stream è¯»å–æ–‡ä»¶å†…å®¹</span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> filename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname <span class="token punctuation">,</span> <span class="token string">'../File/streamæµå½¢å¼å†™å…¥.txt'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>filename <span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">encoding</span> <span class="token operator">:</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">autoClose</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// è¯»å–å®Œæˆåæ˜¯å¦è‡ªåŠ¨å…³é—­ </span>
  <span class="token literal-property property">highWaterMark</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// æŒ‰ç…§æµçš„æ–¹å¼è¯»å–æ¯æ¬¡è¯»å–å¤šå°‘ 64 ä¸º 64kb </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span>

rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'pause'</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log('æš‚åœ');</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span> <span class="token punctuation">,</span> <span class="token parameter">chunk</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  str <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>
  <span class="token comment">// console.log('è¿˜å‰©ä¸‹' , rs.readableEnded , 'å­—èŠ‚');</span>
  rs<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    rs<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ç»§ç»­è¯»å–'</span><span class="token punctuation">,</span> chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
  rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è¯»å–å®Œæˆ å†…å®¹ä¸º'</span> <span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å¼€å¯è¯»å–é€šé“'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="demo"><a href="#demo" class="header-anchor">#</a> demo</h3> <p><strong>å¤åˆ¶å¤§æ–‡ä»¶ã€‚</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * ä¼˜åŒ– å¤åˆ¶æ–‡ä»¶å¡é¡¿é—®é¢˜ ä»¥åŠ èƒŒå‹é—®é¢˜
 */</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>  
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> from <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../File/streamæµå½¢å¼å†™å…¥.txt'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> to <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../File/streamæµå½¢å¼å†™å…¥copy.txt'</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">method1</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span>
  <span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> content<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">method2</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span>
  <span class="token keyword">const</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>
  rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span> <span class="token punctuation">,</span> <span class="token parameter">chunk</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> flag <span class="token operator">=</span>  ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>flag <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      rs<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'drain'</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    rs<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è¯»å–å®Œæˆ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
<span class="token punctuation">}</span>

<span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

æˆ–è€…ä½¿ç”¨ fs<span class="token punctuation">.</span>piple

<span class="token comment">// method1()</span>
</code></pre></div><h3 id="æ‰‹åŠ¨å®ç°-existsæ–¹æ³•"><a href="#æ‰‹åŠ¨å®ç°-existsæ–¹æ³•" class="header-anchor">#</a> æ‰‹åŠ¨å®ç° existsæ–¹æ³•</h3> <p><strong>æ ¹æ® stat æ–¹æ³• åˆ¤æ–­æ–‡ä»¶çŠ¶æ€ è¿”å›æ–‡ä»¶æ˜¯å¦å­˜åœ¨</strong></p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">exists</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token operator">?.</span>errno <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">4058</span> <span class="token operator">&amp;&amp;</span> err<span class="token operator">?.</span>code <span class="token operator">===</span> <span class="token string">'ENOENT'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  exists
<span class="token punctuation">}</span>
</code></pre></div><h3 id="fsæ¨¡å—æ¡ˆä¾‹ç»ƒä¹ "><a href="#fsæ¨¡å—æ¡ˆä¾‹ç»ƒä¹ " class="header-anchor">#</a> fsæ¨¡å—æ¡ˆä¾‹ç»ƒä¹ </h3> <p><strong>éœ€æ±‚</strong>  : å®ç° è¯»å–æŸä¸ªæ–‡ä»¶å¤¹ä¸‹é¢æ‰€æœ‰å†…å®¹ å¹¶ç”Ÿæˆ ä»¥ä¸‹å¯¹è±¡ä¿¡æ¯ï¼Œ</p> <p>è°ƒç”¨ <code>getContent</code>æ–¹æ³•è¯»å–æŸä¸ªæ–‡ä»¶å†…å®¹</p> <p>è°ƒç”¨ <code>getChildren</code> æ–¹æ³•è¯»å–æ‰€æœ‰å†…å®¹ä¿¡æ¯å¹¶è¿”å›ä¸€ä¸ª è¯¥æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯æ•°ç»„</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">File</span> <span class="token operator">:</span>  <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'D:\\èµ„æ–™\\NodeJS\\node-basic\\course-dirs\\module\\fs\\demo\\æ‰‹åŠ¨å¤åˆ¶æ–‡ä»¶.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'æ‰‹åŠ¨å¤åˆ¶æ–‡ä»¶.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ext</span><span class="token operator">:</span> <span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token comment">// æ–‡ä»¶æ‹“å±•å</span>
    <span class="token literal-property property">isFile</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// æ˜¯å¦ä¸º æ–‡ä»¶</span>
    <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">339</span><span class="token punctuation">,</span> <span class="token comment">// æ–‡ä»¶å¤§å°</span>
    <span class="token literal-property property">createTime</span><span class="token operator">:</span> <span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span>13T02<span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">58</span><span class="token punctuation">.</span>014Z<span class="token punctuation">,</span> <span class="token comment">// æ–‡ä»¶åˆ›å»ºæ—¶é—´</span>
    <span class="token literal-property property">updateTime</span><span class="token operator">:</span> <span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span>13T02<span class="token operator">:</span><span class="token number">58</span><span class="token operator">:</span><span class="token number">49</span><span class="token punctuation">.</span>073Z <span class="token comment">// æ–‡ä»¶æ›´æ–°æ—¶é—´</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// è¯»å–ä¸€ä¸ªç›®å½•ä¸‹ æ‰€æœ‰çš„å­æ–‡ä»¶ä»¥åŠæ–‡ä»¶å¤¹ å¹¶ç”Ÿæˆä¸€ä¸ª map</span>

<span class="token keyword">const</span> fsp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>promises
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">File</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">filename<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ext<span class="token punctuation">,</span> isFile<span class="token punctuation">,</span> size<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>filename <span class="token operator">=</span> filename<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ext <span class="token operator">=</span> ext<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isFile <span class="token operator">=</span> isFile<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> size<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>createTime <span class="token operator">=</span> createTime<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>updateTime <span class="token operator">=</span> updateTime<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">async</span> <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token parameter">isBuffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isBuffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">await</span> fsp<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>filename<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">await</span> fsp<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>filename<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">async</span> <span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isFile<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> fileinfos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token keyword">await</span> fsp<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>filename<span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">recursionDirs</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">rootPath<span class="token punctuation">,</span> childrens</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> childPath <span class="token keyword">of</span> childrens<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> filename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>rootPath<span class="token punctuation">,</span> childPath<span class="token punctuation">)</span>
        <span class="token keyword">const</span> isFile <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> fsp<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          fileinfos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          fileinfos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ä¿å­˜å½“å‰ç›®å½•å¯¹è±¡</span>
          <span class="token function">recursionDirs</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token keyword">await</span> fsp<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>fileinfos<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fileinfos <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">recursionDirs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>filename<span class="token punctuation">,</span> children<span class="token punctuation">)</span>
    <span class="token keyword">return</span> fileinfos
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getFile</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fileInfo <span class="token operator">=</span> <span class="token keyword">await</span> fsp<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    <span class="token keyword">const</span> name <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    <span class="token keyword">const</span> ext <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    <span class="token keyword">const</span> isFile <span class="token operator">=</span> fileInfo<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> size <span class="token operator">=</span> fileInfo<span class="token punctuation">.</span>size
    <span class="token keyword">const</span> createTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">.</span>birthtime<span class="token punctuation">)</span>
    <span class="token keyword">const</span> updateTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">.</span>mtime<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ext<span class="token punctuation">,</span> isFile<span class="token punctuation">,</span> size<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">readDir</span><span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token keyword">await</span> File<span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token keyword">await</span> file<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> filename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../demo'</span><span class="token punctuation">)</span>
  <span class="token function">readDir</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="os-æ¨¡å—ğŸ–¥"><a href="#os-æ¨¡å—ğŸ–¥" class="header-anchor">#</a> OS æ¨¡å—ğŸ–¥</h2> <p><a href="https://nodejs.org/api/os.html#osavailableparallelism" target="_blank" rel="noopener noreferrer">æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>ç†è§£ ï¼š ç”¨äºè·å–ç³»ç»Ÿçš„ä¸€äº›ä¿¡æ¯ä»¥åŠç‰ˆæœ¬çš„å†…å®¹</p> <h3 id="åŸºæœ¬api"><a href="#åŸºæœ¬api" class="header-anchor">#</a> åŸºæœ¬Api</h3> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token comment">/// docs </span>
<span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'osEol'</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token constant">EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å– æ¢è¡Œç¬¦</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–cpuçš„æ ¸æ•°</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'freem'</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">freemem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–ç©ºé—²çš„å†…å­˜;</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'release'</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ“ä½œç³»ç»Ÿç‰ˆæœ¬</span>

<span class="token comment">/**
 * @param pid è¦ä¸ºå…¶è®¾ç½®è®¡åˆ’ä¼˜å…ˆçº§çš„è¿›ç¨‹ IDã€‚é»˜è®¤å€¼ï¼š 0 ã€‚
 * @param priority è¦åˆ†é…ç»™æµç¨‹çš„è®¡åˆ’ä¼˜å…ˆçº§ã€‚
 */</span>

<span class="token comment">// os.setPriority([pid,]priority) // è®¾ç½®è¿›ç¨‹çš„ä¼˜å…ˆçº§</span>

console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'æ“ä½œç³»ç»Ÿåç§°'</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// è¿”å›æ“ä½œç³»ç»Ÿåç§°</span>


console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ç”¨æˆ·ç›®å½•&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">homedir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// è¿”å›ç”¨æˆ·ç›®å½•</span>

console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">tmpdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// è¿”å›ä¸´æ—¶ç›®å½•</span>

console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;hostName&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">hostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// è¿”å›ä¸»æœºå</span>
</code></pre></div><h2 id="path-æ¨¡å—ğŸ”—"><a href="#path-æ¨¡å—ğŸ”—" class="header-anchor">#</a> path æ¨¡å—ğŸ”—</h2> <h3 id="windows-vs-posix"><a href="#windows-vs-posix" class="header-anchor">#</a> Windows vs. POSIX</h3> <p><code>node:path</code> æ¨¡å—çš„é»˜è®¤æ“ä½œå› è¿è¡Œ Node.js åº”ç”¨ç¨‹åºçš„æ“ä½œç³»ç»Ÿè€Œå¼‚ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨ Windows æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œæ—¶ï¼Œ <code>node:path</code> æ¨¡å—å°†å‡å®šæ­£åœ¨ä½¿ç”¨ Windows æ ·å¼çš„è·¯å¾„ã€‚</p> <p>å› æ­¤ï¼Œä½¿ç”¨ <code>path.basename()</code> å¯èƒ½ä¼šåœ¨ POSIX å’Œ Windows ä¸Šäº§ç”Ÿä¸åŒçš„ç»“æœï¼š</p> <p><code>linux</code>ä¸Š</p> <div class="language-js extra-class"><pre class="language-js"><code>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">'C:\\temp\\myfile.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Returns: 'C:\\temp\\myfile.html' </span>
</code></pre></div><p><code>Windows</code>ä¸Š</p> <div class="language-js extra-class"><pre class="language-js"><code>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">'C:\\temp\\myfile.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Returns: 'myfile.html' </span>
</code></pre></div><p>è‹¥è¦åœ¨ä»»ä½•æ“ä½œç³»ç»Ÿä¸Šä½¿ç”¨ POSIX æ–‡ä»¶è·¯å¾„æ—¶è·å¾—ä¸€è‡´çš„ç»“æœï¼Œè¯·ä½¿ç”¨ <code>path.posix</code> ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>path<span class="token punctuation">.</span>posix<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">'/tmp/myfile.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Returns: 'myfile.html' </span>
</code></pre></div><h3 id="pathçš„ä¸€äº›æ–¹æ³•"><a href="#pathçš„ä¸€äº›æ–¹æ³•" class="header-anchor">#</a> <strong>pathçš„ä¸€äº›æ–¹æ³•</strong></h3> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span> 
 <span class="token comment">// æ–‡æ¡£  https://nodejs.org/api/path.html#pathbasenamepath-suffix</span>

<span class="token comment">//node:path æ¨¡å—çš„é»˜è®¤æ“ä½œå› è¿è¡Œ Node.js åº”ç”¨ç¨‹åºçš„æ“ä½œç³»ç»Ÿè€Œå¼‚ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨ Windows æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œæ—¶ï¼Œ node:path æ¨¡å—å°†å‡å®šæ­£åœ¨ä½¿ç”¨ Windows æ ·å¼çš„è·¯å¾„ã€‚</span>


<span class="token comment">//è‹¥è¦åœ¨ä»»ä½•æ“ä½œç³»ç»Ÿä¸Šä½¿ç”¨ Windows æ–‡ä»¶è·¯å¾„æ—¶è·å¾—ä¸€è‡´çš„ç»“æœï¼Œè¯·ä½¿ç”¨ path.win32 ï¼š</span>

<span class="token keyword">const</span> baseName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">'a/v/c/d.js'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">)</span> <span class="token comment">// è·å–åŒ¹é…åˆ°çš„æ–‡ä»¶è·¯å¾„åç§° ï¼Œ å‚æ•°ä¸€ ä¸åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'baseName'</span><span class="token punctuation">,</span> baseName<span class="token punctuation">)</span><span class="token punctuation">;</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PATH</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>delimiter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// è·å–è·¯å¾„çš„åˆ†éš”ç¬¦ windows ä¸Šä¸º ; linux ä¸º : </span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è·å–æ‹“å±•åç§°'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token string">'a/b/bc/a.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–æ–‡ä»¶æ‹“å±•åç§°</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è·å–ç³»ç»Ÿçš„è·¯å¾„ç¬¦å·'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span>sep<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–ç³»ç»Ÿçš„è·¯å¾„ç¬¦å·</span>
</code></pre></div><h2 id="utilså·¥å…·æ¨¡å—âœ‚"><a href="#utilså·¥å…·æ¨¡å—âœ‚" class="header-anchor">#</a> utilså·¥å…·æ¨¡å—âœ‚</h2> <p><a href="https://nodejs.org/api/util.html#utildebugsection" target="_blank" rel="noopener noreferrer">æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="callbackify-original"><a href="#callbackify-original" class="header-anchor">#</a> callbackify(original)</h3> <p>å°† ä¸€ä¸ª <code>promise</code> è½¬åŒ–ä¸º <code>callback</code> å½¢å¼ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>
<span class="token comment">/**
 * 
 * @param {*} duration 
 * @param {*} callback 
 * @returns 
 * @description å°† promise å‡½æ•° è½¬æ¢ä¸º callback
 */</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">duration <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'è½¬æ¢æˆåŠŸ , è€—æ—¶'</span> <span class="token operator">+</span> duration<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> newFn <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">callbackify</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
<span class="token function">newFn</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è¿”å›ç»“æœ'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


</code></pre></div><h3 id="debuglog"><a href="#debuglog" class="header-anchor">#</a> debugLog</h3> <p>åœ¨æŒ‡å®šç¯å¢ƒæƒ…å†µä¸‹ è¿è¡Œ æ—¥å¿—è¾“å‡º</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 2 ï¼š debuglog</span>
<span class="token comment">// const debuglog = utils.debuglog('error')</span>
<span class="token comment">// debuglog('error not a function');</span>
</code></pre></div><h3 id="promisify"><a href="#promisify" class="header-anchor">#</a> promisify</h3> <p>å°†ä¸€ä¸ª <code>callback</code> è½¬æ¢ä¸º <code>promise</code></p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> <span class="token function-variable function">dealyCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">duration<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'å›è°ƒæˆåŠŸ'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> dealy <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>dealyCallback<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> dealy<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">queryDealy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">dealy</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">queryDealy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="netæ¨¡å—âš”"><a href="#netæ¨¡å—âš”" class="header-anchor">#</a> netæ¨¡å—âš”</h2> <p><strong>æè¿°</strong> ï¼š netæ¨¡å—æä¾›äº† <code>createConnection</code> and <code>createServer</code>ç”¨äºåˆ›å»ºå®¢æˆ·ç«¯è¿æ¥å’ŒæœåŠ¡å™¨</p> <h3 id="å†…ç½®å‡½æ•°"><a href="#å†…ç½®å‡½æ•°" class="header-anchor">#</a> <strong>å†…ç½®å‡½æ•°</strong></h3> <h4 id="createconnection"><a href="#createconnection" class="header-anchor">#</a> createConnection</h4> <p><strong>desc</strong> : ç”¨äºåˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œå‘æœåŠ¡å™¨å‘é€ç½‘ç»œè¯·æ±‚</p> <p><strong>params</strong> ï¼š <code>options</code>ï¼Œ <code>callback</code></p> <p><strong>callback</strong> : å½“ä¸æœåŠ¡å™¨è¿æ¥æˆåŠŸæ—¶è¿›è¡Œè°ƒç”¨</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> clientSocket <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'duyi.ke.qq.com'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">80</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log('è¿æ¥æˆåŠŸ');</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>äº‹ä»¶(Event)</strong> ğŸ„</p> <p><code>close</code>ï¼Œ <code>data</code> äº‹ä»¶</p> <p>æŒ‰ç…§ httpçš„æ ¼å¼è¿›è¡Œä¼ è¾“ç»™æœåŠ¡ç«¯</p> <div class="language-js extra-class"><pre class="language-js"><code>clientSocket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GET / HTTP/1.1 // è¯·æ±‚è¡Œ
Host: duyi.ke.qq.com // è¯·æ±‚å¤´
Connection: keep-alive
// ç©ºè¡Œ
// è¯·æ±‚ä½“ </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre></div><p>â—ï¸ æ³¨æ„</p> <blockquote><p>å½“ä½ æ‰“å¼€äº†ä¸€ä¸ª è¯·æ±‚è¿æ¥æ—¶,ä»…ä»…æ˜¯æ‰“å¼€äº†ä¸€ä¸ªè¿æ¥ï¼Œä½ éœ€è¦å‘æœåŠ¡ç«¯å‘é€ä¸€å®šçš„è¯·æ±‚å†…å®¹æ‰èƒ½å¾—åˆ°æœåŠ¡ç«¯çš„å“åº”</p></blockquote> <h4 id="createserver"><a href="#createserver" class="header-anchor">#</a> createServer</h4> <p>æè¿° ï¼šåˆ›å»ºä¸€ä¸ªnodeæœåŠ¡å®ä¾‹ï¼Œè¿”å›ä¸€ä¸ªæœåŠ¡å®ä¾‹å¯¹è±¡</p> <p><strong>params</strong> ï¼š æœåŠ¡è¿æ¥çš„<code>callback</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> serverSocket <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
serverSocket<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8805</span><span class="token punctuation">)</span>
serverSocket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'listening'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
serverSocket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token parameter">socket</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">chunk</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> filename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../File/bg.png'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> bodyBuffer <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    <span class="token keyword">const</span> headerBuffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">HTTP/1.1 200 OK
Content-Type: image/png


</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>headerBuffer<span class="token punctuation">,</span> bodyBuffer<span class="token punctuation">]</span><span class="token punctuation">)</span>
    socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    socket<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>**äº‹ä»¶(Event)**ğŸ„</p> <p><strong>listen</strong> : å¼€å¯ç›‘å¬</p> <p><strong>connection</strong>ï¼š å½“å®¢æˆ·ç«¯æœ‰è¯·æ±‚å‘åˆ°æœåŠ¡ç«¯æ—¶è§¦å‘</p> <p><strong>data</strong> ï¼š å½“å®¢æˆ·ç«¯æœ‰æ•°æ®å‘é€è¿‡æ¥æ—¶è§¦å‘</p> <h2 id="httpå’Œ-https-æ¨¡å—ğŸ—‘"><a href="#httpå’Œ-https-æ¨¡å—ğŸ—‘" class="header-anchor">#</a> HTTPå’Œ HTTPS æ¨¡å—ğŸ—‘</h2> <h3 id="http-æ¨¡å—"><a href="#http-æ¨¡å—" class="header-anchor">#</a> HTTP æ¨¡å—</h3> <p>æè¿° ï¼šè¯¥æ¨¡å—æä¾›äº†æœåŠ¡ç«¯å‘é€è¯·æ±‚çš„æ–¹æ³•ï¼ŒæœåŠ¡ç«¯å¯ä»¥é€šè¿‡è°ƒç”¨ <code>request</code>è¿›è¡Œè¯·æ±‚</p> <ol><li>http.<code>ClientRequest</code></li> <li>http.<code>server</code></li> <li>http.<code>serverResponse</code></li> <li>http.<code>IncomingMessage</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token keyword">const</span> request <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> config<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
      <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> config<span class="token punctuation">.</span>method <span class="token operator">||</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token parameter">chunk</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// æ³¨æ„äº‹é¡¹  è¯·æ±‚å‘é€å‡ºå»å éœ€è¦æ‰‹åŠ¨è°ƒç”¨endæ–¹æ³•æ‰èƒ½ è·å–å“åº”ç»“æœ</span>
    request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="nodejs-eventemmiter"><a href="#nodejs-eventemmiter" class="header-anchor">#</a> nodejs - EventEmmiter</h2> <p><strong>EventEmmiter</strong> ï¼š ç”¨äºæ—¶é—´è®¢é˜…å‘å¸ƒçš„ä¸€ä¸ªç±»</p> <h3 id="event"><a href="#event" class="header-anchor">#</a> event</h3> <ol><li>on äº‹ä»¶ ï¼š ç”¨äºç›‘å¬æŸä¸ªäº‹ä»¶</li> <li>emit : ç”¨äºå‘å°„æŸä¸ª</li> <li>off ï¼š å…³é—­æŸä¸ªæ³¨å†Œçš„äº‹ä»¶</li></ol> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> EventEmitter <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> ev <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'clickäº‹ä»¶è§¦å‘'</span> <span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token comment">// æ³¨å†Œäº‹ä»¶</span>
ev<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span> <span class="token punctuation">,</span>handleClick<span class="token punctuation">)</span>

ev<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'click'</span> <span class="token punctuation">,</span> <span class="token string">'ok'</span><span class="token punctuation">)</span> <span class="token comment">// è§¦å‘äº‹ä»¶ </span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ev<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'click'</span> <span class="token punctuation">,</span>handleClick<span class="token punctuation">)</span> <span class="token comment">// ç§»é™¤ click äº‹ä»¶</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span><span class="token function">listenerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–ç›‘å¬çš„æ€»æ•°</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="nodejs-äº‹ä»¶å¾ªç¯ğŸš™"><a href="#nodejs-äº‹ä»¶å¾ªç¯ğŸš™" class="header-anchor">#</a> nodejs äº‹ä»¶å¾ªç¯ğŸš™</h2> <p><a href="https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick" target="_blank" rel="noopener noreferrer">nodejs äº‹ä»¶å¾ªç¯å®˜æ–¹æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="header-anchor">#</a> å®šä¹‰</h3> <p>å®šä¹‰ ï¼š å½“ç¨‹åºè¿è¡Œåˆ™è¿›å…¥<code>äº‹ä»¶å¾ªç¯</code>ï¼Œnodejsäº‹ä»¶å¾ªç¯åˆ†ä¸ºå…­ä¸ªé˜¶æ®µ</p> <ol><li><strong>timers</strong></li> <li><strong>pedding-callback</strong></li> <li><strong>idle-prepare</strong></li> <li><strong>poll</strong></li> <li><strong>check</strong></li> <li><strong>close-callbacks</strong></li> <li>nextTick</li> <li>Promise</li></ol> <h3 id="è¿è¡Œé˜¶æ®µ"><a href="#è¿è¡Œé˜¶æ®µ" class="header-anchor">#</a> è¿è¡Œé˜¶æ®µ</h3> <h4 id="timers"><a href="#timers" class="header-anchor">#</a> timers</h4> <p>ç†è§£ï¼šæ­¤é˜¶æ®µæ‰§è¡Œç”± <code>setTimeout()</code> å’Œ <code>setInterval()</code> è°ƒåº¦çš„å›è°ƒã€‚</p> <h4 id="pending-callbacks"><a href="#pending-callbacks" class="header-anchor">#</a> <strong>pending callbacks</strong></h4> <p>ç†è§£ ï¼š æ‰§è¡Œå»¶è¿Ÿåˆ°ä¸‹ä¸€ä¸ªå¾ªç¯è¿­ä»£çš„ I/O å›è°ƒï¼Œè¢«æ¨è¿Ÿåˆ°ä¸‹ä¸€æ¬¡çš„ioæ“ä½œçš„å›è°ƒï¼Œåœ¨æ­¤äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œ</p> <h4 id="idle-prepare"><a href="#idle-prepare" class="header-anchor">#</a> <strong>idle, prepare</strong></h4> <p>ç©ºé—²ï¼Œå‡†å¤‡ï¼šä»…åœ¨å†…éƒ¨ä½¿ç”¨ã€‚</p> <h4 id="poll"><a href="#poll" class="header-anchor">#</a> <strong>poll</strong></h4> <p>ç†è§£ ï¼š è½®è¯¢æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„ <code>I/O</code>æ–‡ä»¶æ“ä½œæˆ–è€… æœåŠ¡ç›‘å¬å›åˆ°æ“ä½œï¼Œå¦‚æœæœ‰åˆ™åœ¨è¯¥äº‹ä»¶å¾ªç¯ä¸­è¿è¡Œï¼Œç„¶åè¿è¡Œå®Œæˆåï¼Œåˆ¤æ–­å…¶å®ƒçš„  <code>timers</code> or <code>check</code> ä¸­æ˜¯å¦æœ‰ä»»åŠ¡æ‰§è¡Œ ï¼Œ æœ‰åˆ™å®Œæˆå½“å‰ <code>poll</code>ä»»åŠ¡ è¿›è¡Œ <code>check</code> ä»»åŠ¡æ‰§è¡Œï¼Œç„¶åå¼€å§‹æ–°çš„ä¸€è½®äº‹ä»¶å¾ªç¯ã€‚</p> <h4 id="check"><a href="#check" class="header-anchor">#</a> check</h4> <p>ç†è§£ ï¼š å•ç‹¬å¤„ç†ä»£ç ä¸­ çš„  <code>setImmediate</code> å›åˆ°ï¼Œå½“é‡åˆ° setImmediate ä¼šç«‹å³åŠ å…¥åˆ°æœ¬é˜Ÿåˆ—ä¸­ï¼Œç„¶åç«‹å³æ‰§è¡Œã€‚</p> <h4 id="close-callbacks"><a href="#close-callbacks" class="header-anchor">#</a> <strong>close callbacks</strong></h4> <p>ç†è§£ ï¼š ä¸€äº›å…³é—­å›è°ƒï¼Œä¾‹å¦‚ <code>socket.on('close', ...)</code> ã€‚</p> <h4 id="nexttick"><a href="#nexttick" class="header-anchor">#</a> nextTick</h4> <p>ç†è§£ ï¼š <code>nextTick</code> å±äºå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ŒnextTickä¼˜å…ˆçº§é«˜äºPromise ï¼Œå½“æ¯ä¸€æ¬¡å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¼š é©¬ä¸Šæ¸…ç©ºå½“å‰äº‹ä»¶å¾ªç¯çš„æ‰€æœ‰çš„å¾®ä»»åŠ¡ã€‚</p> <h4 id="promise"><a href="#promise" class="header-anchor">#</a> Promise</h4> <p>ç†è§£ ï¼š <code>Promise</code> å±äºå¾®ä»»åŠ¡ ï¼Œ ä¼˜å…ˆçº§ä»…æ¬¡äº nextTickï¼Œå½“nextTick è¢«æ‰§è¡Œå®Œæˆå ä¼šæ‰§è¡Œ Promise  å¦‚æœ Promise ä¸­ å­˜åœ¨ <code>nextTick</code> åˆ™ è¿˜ä¼šç»§ç»­æ‰§è¡Œ <code>nextTick</code></p> <h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h3> <p>å½“ç¨‹åºè¿è¡Œåˆ™è¿›å…¥<code>äº‹ä»¶å¾ªç¯</code> ï¼Œ é¦–å…ˆä¼šè¿›è¡Œ <code>settimeout or setinterval</code> ä»»åŠ¡æ£€æŸ¥ çœ‹çœ‹æ˜¯å¦æœ‰ç¬¦åˆçš„ <code>callback</code>å¦‚æœæœ‰ åˆ™è¿è¡Œ æ²¡æœ‰ åˆ™ è¿è¡Œ å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ ï¼Œå†å‘ä¸‹ æ‰§è¡Œ <code>poll</code> ï¼Œ æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶ <code>I/O</code>æ–‡ä»¶æ“ä½œ æˆ–è€… äº‹ä»¶ç›‘å¬æ“ä½œ(server.linstent) ,æœ‰åˆ™è¿è¡Œ ï¼Œæ²¡æœ‰åˆ™è½®è¯¢æŸ¥çœ‹å…¶ä»–çš„  ä»»åŠ¡ä¸­æ˜¯å¦æœ‰<code>callback</code> ï¼Œ å¦‚æœå‘ç°æœ‰åˆ™ç»“æŸå½“å‰ <code>poll</code> ä»»åŠ¡ ï¼Œ æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ— ï¼Œ æ‰§è¡Œ <code>check</code>é˜Ÿåˆ— ï¼Œä¾æ¬¡æ‰§è¡Œï¼Œç›´åˆ° <code>close callback</code> å¼€å¯ä¸‹ä¸€è½®æ–°çš„äº‹ä»¶å¾ªç¯ã€‚</p> <p>ğŸš©</p> <p><img src="/assets/img/1693380487884.95d45b7a.png" alt="1693380487884"></p> <h3 id="settimeoutå’Œsetimmediate-æ‰§è¡Œæ—¶æœº"><a href="#settimeoutå’Œsetimmediate-æ‰§è¡Œæ—¶æœº" class="header-anchor">#</a> settimeoutå’ŒsetImmediate æ‰§è¡Œæ—¶æœº</h3> <h4 id="ç‰¹æ®Šæƒ…å†µ"><a href="#ç‰¹æ®Šæƒ…å†µ" class="header-anchor">#</a> ç‰¹æ®Šæƒ…å†µ</h4> <p>å½“<code>settimeout</code>å’Œ<code>setImmediate</code> åŒæ—¶å­˜åœ¨æ—¶ éœ€è¦è€ƒè™‘ è®¡ç®—æœºçš„è¿è¡Œæ—¶æœºï¼Œæœ‰å¯èƒ½settimeout 0 ç§’ æ‰§è¡Œæ—¶æœº æ˜¯å¿«äº setImmediateçš„ã€‚</p> <h4 id="ä»€ä¹ˆæƒ…å†µä¸‹äº§ç”Ÿ-ğŸ˜¢"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹äº§ç”Ÿ-ğŸ˜¢" class="header-anchor">#</a> ä»€ä¹ˆæƒ…å†µä¸‹äº§ç”Ÿ ï¼ŸğŸ˜¢</h4> <p>å¦‚æœåœ¨è¿è¡Œnodejs äº‹ä»¶å¾ªç¯å¼€å§‹æ—¶ï¼Œè®¡ç®—æœºå¡é¡¿çš„ä¸€ç¬é—´å¯èƒ½å¯¼è‡´<code>settimeout</code> å·²ç»åŠ å…¥åˆ° <code>timer</code> é˜Ÿåˆ—ä¸­å»ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯ï¼Œæ…¢äº <code>timer</code>çš„æ‰§è¡Œï¼Œå³ä½¿ settimeout ä¸º 0ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setImmediate</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>ğŸ˜Šç¤ºä¾‹ï¼š</p> <p><img src="/assets/img/1693386218582.ce46d58e.png" alt="1693386218582"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/web/React/React.html" class="prev">
        React
      </a></span> <span class="next"><a href="/web/sql/mysql.html">
        Mysql
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.feb21b2a.js" defer></script><script src="/assets/js/2.75ba61f2.js" defer></script><script src="/assets/js/5.fb1d9eba.js" defer></script>
  </body>
</html>
